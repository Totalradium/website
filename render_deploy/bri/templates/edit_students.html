{% extends 'students.html' %}

{% block title %}
  Edit Student
{% endblock %}

{% block content %}
  <form method="POST">
    {% csrf_token %}

    <div class="row mb-3">
      <div class="col-md-6">
        <label>First Name</label>
        <input type="text" name="first_name" class="form-control" value="{{ student.std_fname }}" required>
      </div>
      <div class="col-md-6">
        <label>Last Name</label>
        <input type="text" name="last_name" class="form-control" value="{{ student.std_lname }}">
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label>Username</label>
        <input type="text" name="username" class="form-control" 
              value="{{ student.username.username }}" required>
      </div>
      <div class="col-md-6">
        <label>Password</label>
        <input type="password" name="password" class="form-control" 
              placeholder="Leave blank to keep unchanged">
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-6">
        <label>Date of Birth</label>
        <input type="date" name="dob" class="form-control" value="{{ student.std_dob|date:'Y-m-d' }}" required>
      </div>
      <div class="col-md-6">
        <label>Roll Number</label>
        <input type="number" name="std_roll" class="form-control" value="{{ student.std_roll }}" required>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-6">
        <label>Class</label>
        <select class="form-select" name="class" id="class" required>
          <option disabled>No option selected</option>
          {% for cls in classes %}
            <option value="{{ cls.id }}" {% if student.std_class.id == cls.id %}selected{% endif %}>{{ cls.class_name }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-6">
        <label>Section</label>
        <select class="form-select" name="section" id="section" required>
          <option disabled>Not Selected</option>
          {% for section in sections %}
            <option value="{{ section.id }}" {% if student.std_section and student.std_section.id == section.id %}selected{% endif %}>{{ section.std_section }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-6">
        <label>Gender</label>
        <select class="form-select" name="gender" required>
          <option disabled>Not Selected</option>
          <option value="Male" {% if student.gender == 'Male' %}selected{% endif %}>Male</option>
          <option value="Female" {% if student.gender == 'Female' %}selected{% endif %}>Female</option>
        </select>
      </div>
    </div>

    <h5 class="mt-4 mb-3">Guardian Details</h5>

    <div class="row mb-3">
      <div class="col-md-6">
        <label>Guardian Name</label>
        <input type="text" name="guardian_name" class="form-control" value="{{ student.guardian_name }}">
      </div>
      <div class="col-md-6">
        <label>Contact 1</label>
        <input type="tel" name="guardian_contact1" class="form-control" value="{{ student.guardian_contact1 }}" placeholder="+92...">
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-6">
        <label>Contact 2</label>
        <input type="tel" name="guardian_contact2" class="form-control" value="{{ student.guardian_contact2 }}" placeholder="+92...">
      </div>
    </div>

      <div class="mb-3">
        <label for="address" class="form-label">Address</label>
        <textarea name="address" id="address" class="form-control" rows="3">{{ student.address }}</textarea>
      </div>

    <div class="mb-3">
      <label for="discountAmount" class="form-label">Fee Discount (PKR)</label>
      <input type="number" class="form-control" name="discount_amount" min="0" value="{{ student.discount_amount }}">
    </div>

    <button type="submit" class="btn btn-primary">Save Changes</button>
  </form>

  <script>
    document.getElementById('class').addEventListener('change', function() {
      const classId = this.value;
      const sectionSelect = document.getElementById('section');
      sectionSelect.innerHTML = '<option disabled>Not Selected</option>';

      fetch(`/get_sections_for_class/${classId}/`)
        .then(response => response.json())
        .then(data => {
          data.sections.forEach(section => {
            const option = document.createElement('option');
            option.value = section.id;
            option.text = section.std_section;
            sectionSelect.appendChild(option);
          });
        });
    });
  </script>
{% endblock %}
